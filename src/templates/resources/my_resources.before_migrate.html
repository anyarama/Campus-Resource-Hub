{% extends "base.html" %}


{% block title %}My Resources - Campus Resource Hub{% endblock %}

{% block content %}
  <!-- Header Section -->
  <div class="layout-grid">
    <div class="layout-col" data-col="12">
      <h1 class="display-5"><i class="bi bi-collection icon"></i> My Resources</h1>
      <p class="text-muted">Manage and track all your listed resources</p>
    </div>
    <div class="layout-col text-md-end" data-col="12">
      <a href="{{ url_for('resources.create') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle icon"></i> Create New Resource
      </a>
    </div>
  </div>

  {% if resources and resources|length > 0 %}
  <!-- Statistics Cards -->
  <div class="layout-grid">
    <div class="layout-col" data-col="12">
      <div class="card">
        <div class="card-body">
          <div class="stat-icon">
            <i class="bi bi-collection text-primary icon" style="font-size: 2rem;"></i>
          </div>
          <h3 class="mb-0">{{ resources|length }}</h3>
          <p class="text-muted small">Total Resources</p>
        </div>
      </div>
    </div>
    <div class="layout-col" data-col="12">
      <div class="card">
        <div class="card-body">
          <div class="stat-icon">
            <i class="bi bi-check-circle icon" style="font-size: 2rem;"></i>
          </div>
          <h3 class="mb-0">{{ resources|selectattr('status', 'equalto', 'published')|list|length }}</h3>
          <p class="text-muted small">Published</p>
        </div>
      </div>
    </div>
    <div class="layout-col" data-col="12">
      <div class="card">
        <div class="card-body">
          <div class="stat-icon">
            <i class="bi bi-file-earmark text-secondary icon" style="font-size: 2rem;"></i>
          </div>
          <h3 class="mb-0">{{ resources|selectattr('status', 'equalto', 'draft')|list|length }}</h3>
          <p class="text-muted small">Drafts</p>
        </div>
      </div>
    </div>
    <div class="layout-col" data-col="12">
      <div class="card">
        <div class="card-body">
          <div class="stat-icon">
            <i class="bi bi-archive icon" style="font-size: 2rem;"></i>
          </div>
          <h3 class="mb-0">{{ resources|selectattr('status', 'equalto', 'archived')|list|length }}</h3>
          <p class="text-muted small">Archived</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Tabs -->
  <ul class="nav nav-tabs" id="resourceTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active btn btn--primary" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
        All ({{ resources|length }})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link btn btn--primary" id="published-tab" data-bs-toggle="tab" data-bs-target="#published" type="button" role="tab">
        Published ({{ resources|selectattr('status', 'equalto', 'published')|list|length }})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link btn btn--primary" id="draft-tab" data-bs-toggle="tab" data-bs-target="#draft" type="button" role="tab">
        Drafts ({{ resources|selectattr('status', 'equalto', 'draft')|list|length }})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link btn btn--primary" id="archived-tab" data-bs-toggle="tab" data-bs-target="#archived" type="button" role="tab">
        Archived ({{ resources|selectattr('status', 'equalto', 'archived')|list|length }})
      </button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="resourceTabContent">
    <!-- All Resources -->
    <div class="tab-pane fade show active" id="all" role="tabpanel">
      {% for resource in resources %}
        {% include 'resources/_resource_card.html' %}
      {% endfor %}
    </div>

    <!-- Published Resources -->
    <div class="tab-pane fade" id="published" role="tabpanel">
      {% set published_resources = resources|selectattr('status', 'equalto', 'published')|list %}
      {% if published_resources %}
        {% for resource in published_resources %}
          {% include 'resources/_resource_card.html' %}
        {% endfor %}
      {% else %}
        <div class="text-center">
          <i class="bi bi-inbox icon" style="font-size: 3rem; color: var(--brand-600);"></i>
          <p class="text-muted">No published resources yet.</p>
          <a href="{{ url_for('resources.create') }}" class="btn btn-primary">Create Your First Resource</a>
        </div>
      {% endif %}
    </div>

    <!-- Draft Resources -->
    <div class="tab-pane fade" id="draft" role="tabpanel">
      {% set draft_resources = resources|selectattr('status', 'equalto', 'draft')|list %}
      {% if draft_resources %}
        {% for resource in draft_resources %}
          {% include 'resources/_resource_card.html' %}
        {% endfor %}
      {% else %}
        <div class="text-center">
          <i class="bi bi-inbox icon" style="font-size: 3rem; color: var(--brand-600);"></i>
          <p class="text-muted">No draft resources.</p>
        </div>
      {% endif %}
    </div>

    <!-- Archived Resources -->
    <div class="tab-pane fade" id="archived" role="tabpanel">
      {% set archived_resources = resources|selectattr('status', 'equalto', 'archived')|list %}
      {% if archived_resources %}
        {% for resource in archived_resources %}
          {% include 'resources/_resource_card.html' %}
        {% endfor %}
      {% else %}
        <div class="text-center">
          <i class="bi bi-inbox icon" style="font-size: 3rem; color: var(--brand-600);"></i>
          <p class="text-muted">No archived resources.</p>
        </div>
      {% endif %}
    </div>
  </div>

  {% else %}
  <!-- Empty State -->
  <div class="layout-grid">
    <div class="col-lg-6 mx-auto">
      <div class="card">
        <div class="card-body">
          <i class="bi bi-collection icon" style="font-size: 5rem; color: var(--brand-600);"></i>
          <h3 class="mt-4">No Resources Yet</h3>
          <p class="text-muted">
            Get started by creating your first resource. Share study spaces, equipment, 
            or any campus resource with the community.
          </p>
          <a href="{{ url_for('resources.create') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle icon"></i> Create Your First Resource
          </a>
        </div>
      </div>

      <!-- Tips Card -->
      <div class="card">
        <div class="card-body">
          <h6 class="card-title"><i class="bi bi-lightbulb icon"></i> What can I share?</h6>
          <ul class="mb-0">
            <li>Study rooms and collaboration spaces</li>
            <li>Technology and equipment (laptops, projectors, cameras)</li>
            <li>Lab instruments and workshop tools</li>
            <li>Event spaces for meetings and gatherings</li>
            <li>Tutoring time and mentoring sessions</li>
            <li>Sports facilities and recreational equipment</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<style>
  /* Statistics cards styling */
  .stat-icon {
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .card.shadow-sm {
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .card.shadow-sm:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
  }

  /* Tab styling */
  .nav-tabs .nav-link {
    color: var(--brand-600);
    border: none;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
  }

  .nav-tabs .nav-link:hover {
    border-bottom-color: var(--brand-600);
  }

  .nav-tabs .nav-link.active {
    color: var(--brand-600);
    background-color: transparent;
    border-bottom-color: var(--brand-600);
    font-weight: 600;
  }

  /* Empty state styling */
  .text-center .bi {
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }
</style>

<!-- Resource Card Partial Template (inline for now) -->
{% macro resource_card(resource) %}
<div class="card resource-card">
  <div class="card-body">
    <div class="layout-grid">
      <div class="layout-col" data-col="12">
        <div class="d-flex align-items-start">
          <div class="flex-grow-1">
            <h5 class="card-title">
              <a href="{{ url_for('resources.detail', resource_id=resource.resource_id) }}" class="text-decoration-none">
                {{ resource.title }}
              </a>
            </h5>
            <p class="card-text small">
              {{ resource.description[:150] }}{% if resource.description|length > 150 %}...{% endif %}
            </p>
            <div class="d-flex flex-wrap gap-2">
              <span class="badge badge-light text-dark border">
                <i class="bi bi-tag icon"></i> {{ resource.category or 'Uncategorized' }}
              </span>
              <span class="badge badge-light text-dark border">
                <i class="bi bi-geo-alt icon"></i> {{ resource.location }}
              </span>
              {% if resource.capacity %}
              <span class="badge badge-light text-dark border">
                <i class="bi bi-people icon"></i> {{ resource.capacity }}
              </span>
              {% endif %}
              <span class="badge 
                {% if resource.status == 'draft' %}bg-secondary
                {% elif resource.status == 'published' %}bg-success
                {% else %}bg-warning{% endif %}">
                {{ resource.status|upper }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="layout-col text-md-end mt-md-0" data-col="12">
        <div class="btn-group-vertical gap-2" role="group">
          <a href="{{ url_for('resources.detail', resource_id=resource.resource_id) }}" 
            class="btn btn-outline-primary">
            <i class="bi bi-eye icon"></i> View
          </a>
          <a href="{{ url_for('resources.edit', resource_id=resource.resource_id) }}" 
            class="btn btn-outline-secondary">
            <i class="bi bi-pencil icon"></i> Edit
          </a>
          {% if resource.status == 'draft' %}
          <form method="POST" action="{{ url_for('resources.publish', resource_id=resource.resource_id) }}" class="d-inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-outline-success btn--primary">
              <i class="bi bi-check-circle icon"></i> Publish
            </button>
          </form>
          {% elif resource.status == 'published' %}
          <form method="POST" action="{{ url_for('resources.archive', resource_id=resource.resource_id) }}" class="d-inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-outline-warning btn--primary">
              <i class="bi bi-archive icon"></i> Archive
            </button>
          </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="card-footer small">
    <i class="bi bi-calendar icon"></i> Created {{ resource.created_at.strftime('%b %d, %Y') if resource.created_at else 'Unknown' }}
    <span class="ms-3"><i class="bi bi-calendar-check icon"></i> Bookings: Coming Soon</span>
    <span class="ms-3"><i class="bi bi-star icon"></i> Rating: Coming Soon</span>
  </div>
</div>
{% endmacro %}

<!-- Render cards using macro -->
{% if resources %}
<template id="resource-card-template">
  {% for resource in resources %}
  {% if loop.index == 1 %}
  <!-- Hidden template, actual cards rendered in tabs -->
  {% endif %}
  {% endfor %}
</template>
{% endif %}
{% endblock %}
