{% extends "base.html" %}
{% from "bookings/_booking_card.html" import render_booking_card %}

{% block title %}My Bookings{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <p class="eyebrow">Bookings</p>
    <h1>My Bookings</h1>
    <p class="text-dim">Review every reservation in one place and jump back into the workflows that matter.</p>
  </div>
</div>

<div class="booking-sections">
  <section class="booking-section" id="upcoming">
    <header class="booking-section__header">
      <div>
        <h2>Upcoming</h2>
        <p class="text-dim">{{ upcoming_count }} booking{{ '' if upcoming_count == 1 else 's' }} scheduled.</p>
      </div>
      <span class="badge badge-primary">{{ upcoming_count }}</span>
    </header>
    {% if upcoming_bookings %}
      {% for booking, resource in upcoming_bookings %}
        {{ render_booking_card(booking, resource, show_actions=True) }}
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <i class="bi bi-calendar-x icon"></i>
        <h3>No upcoming bookings</h3>
        <p class="text-dim">Browse the catalog to reserve a new resource.</p>
        <a href="{{ url_for('resources.index') }}" class="btn btn-primary">
          <i class="bi bi-search"></i> Browse resources
        </a>
      </div>
    {% endif %}
  </section>

  <section class="booking-section" id="pending">
    <header class="booking-section__header">
      <div>
        <h2>Pending Approval</h2>
        <p class="text-dim">{{ pending_count }} booking{{ '' if pending_count == 1 else 's' }} waiting on owners.</p>
      </div>
      <span class="badge badge-warning text-dark">{{ pending_count }}</span>
    </header>
    {% if pending_bookings %}
      {% for booking, resource in pending_bookings %}
        {{ render_booking_card(booking, resource, show_actions=True) }}
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <i class="bi bi-hourglass-split icon"></i>
        <h3>No pending requests</h3>
        <p class="text-dim">You've responded to every booking decision.</p>
      </div>
    {% endif %}
  </section>

  <section class="booking-section" id="past">
    <header class="booking-section__header">
      <div>
        <h2>Past</h2>
        <p class="text-dim">{{ past_count }} completed booking{{ '' if past_count == 1 else 's' }} on record.</p>
      </div>
      <span class="badge badge-success">{{ past_count }}</span>
    </header>
    {% if past_bookings %}
      {% for booking, resource in past_bookings %}
        {{ render_booking_card(booking, resource, show_actions=True) }}
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <i class="bi bi-clock-history icon"></i>
        <h3>No past bookings</h3>
        <p class="text-dim">Once you complete a reservation it will appear here.</p>
      </div>
    {% endif %}
  </section>

  <section class="booking-section" id="cancelled">
    <header class="booking-section__header">
      <div>
        <h2>Cancelled & Rejected</h2>
        <p class="text-dim">{{ cancelled_count }} archived booking{{ '' if cancelled_count == 1 else 's' }}.</p>
      </div>
      <span class="badge badge-secondary">{{ cancelled_count }}</span>
    </header>
    {% if cancelled_bookings %}
      {% for booking, resource in cancelled_bookings %}
        {{ render_booking_card(booking, resource, show_actions=True) }}
      {% endfor %}
    {% else %}
      <div class="empty-state">
        <i class="bi bi-check-circle icon"></i>
        <h3>No cancellations</h3>
        <p class="text-dim">All of your reservations are active or complete.</p>
      </div>
    {% endif %}
  </section>
</div>

<div class="layout-grid gap-lg space-t-4">
  <div class="layout-col" data-col-lg="6">
    <div class="card">
      <div class="card-body">
        <h3 class="space-b-2"><i class="bi bi-lightning-charge icon"></i> Quick actions</h3>
        <p class="text-dim">Keep browsing to discover new campus resources or list one you manage.</p>
        <div class="flex gap-sm wrap">
          <a href="{{ url_for('resources.index') }}" class="btn btn-primary">
            <i class="bi bi-search"></i> Browse catalog
          </a>
          <a href="{{ url_for('resources.create') }}" class="btn btn-secondary">
            <i class="bi bi-plus-circle"></i> List a resource
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="layout-col" data-col-lg="6">
    <div class="card">
      <div class="card-body">
        <h3 class="space-b-2"><i class="bi bi-question-circle icon"></i> Status glossary</h3>
        <ul class="status-list">
          <li><span class="badge badge-warning text-dark">Pending</span> Awaiting owner approval.</li>
          <li><span class="badge badge-success">Approved</span> Confirmed and upcoming.</li>
          <li><span class="badge badge-primary">Completed</span> Finished - ready for reviews.</li>
          <li><span class="badge badge-secondary">Cancelled</span> Closed or rejected.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
