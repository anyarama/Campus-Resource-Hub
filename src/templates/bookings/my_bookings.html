{% extends "base.html" %}
{% from "bookings/_booking_card.html" import render_booking_card %}

{% block title %}My Bookings{% endblock %}

{% block content %}
    <!-- Page Header -->
    <div class="row ">
        <div class="col">
            <h2>
                <i class="bi bi-calendar-check "></i>My Bookings
            </h2>
            <p class="text-muted">Manage all your resource bookings in one place</p>
        </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs " id="bookingTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" 
                    type="button" role="tab" aria-controls="upcoming" aria-selected="true">
                <i class="bi bi-calendar-event "></i>
                Upcoming <span class="badge badge-primary ">{{ upcoming_count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" 
                    type="button" role="tab" aria-controls="pending" aria-selected="false">
                <i class="bi bi-clock-history "></i>
                Pending <span class="badge badge-warning text-dark ">{{ pending_count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" 
                    type="button" role="tab" aria-controls="past" aria-selected="false">
                <i class="bi bi-check-circle "></i>
                Past <span class="badge badge-success ">{{ past_count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="cancelled-tab" data-bs-toggle="tab" data-bs-target="#cancelled" 
                    type="button" role="tab" aria-controls="cancelled" aria-selected="false">
                <i class="bi bi-x-circle "></i>
                Cancelled/Rejected <span class="badge badge-secondary ">{{ cancelled_count }}</span>
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="bookingTabsContent">
        <!-- Upcoming Bookings Tab -->
        <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
            {% if upcoming_bookings %}
                <div class="alert alert-info ">
                    <i class="bi bi-info-circle "></i>
                    You have <strong>{{ upcoming_count }}</strong> upcoming booking{{ 's' if upcoming_count != 1 else '' }}.
                </div>
                {% for booking, resource in upcoming_bookings %}
                    {{ render_booking_card(booking, resource, show_actions=True) }}
                {% endfor %}
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-calendar-x text-muted" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-muted">No Upcoming Bookings</h4>
                    <p class="text-muted">You don't have any approved bookings scheduled.</p>
                    <a href="{{ url_for('resources.index') }}" class="btn btn-primary ">
                        <i class="bi bi-search "></i>Browse Resources
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Pending Bookings Tab -->
        <div class="tab-pane fade" id="pending" role="tabpanel" aria-labelledby="pending-tab">
            {% if pending_bookings %}
                <div class="alert alert-warning ">
                    <i class="bi bi-hourglass-split "></i>
                    You have <strong>{{ pending_count }}</strong> booking{{ 's' if pending_count != 1 else '' }} awaiting approval.
                </div>
                {% for booking, resource in pending_bookings %}
                    {{ render_booking_card(booking, resource, show_actions=True) }}
                {% endfor %}
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-hourglass text-muted" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-muted">No Pending Bookings</h4>
                    <p class="text-muted">You don't have any bookings waiting for approval.</p>
                </div>
            {% endif %}
        </div>

        <!-- Past Bookings Tab -->
        <div class="tab-pane fade" id="past" role="tabpanel" aria-labelledby="past-tab">
            {% if past_bookings %}
                <div class="alert alert-success ">
                    <i class="bi bi-check-circle "></i>
                    You have <strong>{{ past_count }}</strong> completed booking{{ 's' if past_count != 1 else '' }}.
                </div>
                {% for booking, resource in past_bookings %}
                    {{ render_booking_card(booking, resource, show_actions=True) }}
                {% endfor %}
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-clock-history text-muted" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-muted">No Past Bookings</h4>
                    <p class="text-muted">You haven't completed any bookings yet.</p>
                </div>
            {% endif %}
        </div>

        <!-- Cancelled/Rejected Bookings Tab -->
        <div class="tab-pane fade" id="cancelled" role="tabpanel" aria-labelledby="cancelled-tab">
            {% if cancelled_bookings %}
                <div class="alert alert-secondary ">
                    <i class="bi bi-x-circle "></i>
                    You have <strong>{{ cancelled_count }}</strong> cancelled or rejected booking{{ 's' if cancelled_count != 1 else '' }}.
                </div>
                {% for booking, resource in cancelled_bookings %}
                    {{ render_booking_card(booking, resource, show_actions=True) }}
                {% endfor %}
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-check-circle text-muted" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-muted">No Cancelled Bookings</h4>
                    <p class="text-muted">Great! All your bookings are active or completed.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Quick Actions Card -->
    <div class="card shadow-sm ">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="grid-col-md-8">
                    <h5 class="mb-2">
                        <i class="bi bi-lightning-charge "></i>Quick Actions
                    </h5>
                    <p class="text-muted ">
                        Looking for more resources to book or want to share your own?
                    </p>
                </div>
                <div class="grid-col-md-4 text-md-end  mt-md-0">
                    <a href="{{ url_for('resources.index') }}" class="btn btn-primary ">
                        <i class="bi bi-search "></i>Browse
                    </a>
                    <a href="{{ url_for('resources.create') }}" class="btn btn-secondary">
                        <i class="bi bi-plus-circle "></i>List Resource
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div class="card border-0 bg-light ">
        <div class="card-body">
            <h6 class="mb-3">
                <i class="bi bi-question-circle "></i>Understanding Booking Status
            </h6>
            <div class="grid">
                <div class="grid-col-md-3 ">
                    <span class="badge badge-warning text-dark">Pending</span>
                    <small class="d-block  text-muted">Awaiting owner approval</small>
                </div>
                <div class="grid-col-md-3 ">
                    <span class="badge badge-success">Approved</span>
                    <small class="d-block  text-muted">Confirmed and upcoming</small>
                </div>
                <div class="grid-col-md-3 ">
                    <span class="badge badge-primary">Completed</span>
                    <small class="d-block  text-muted">Finished - can leave review</small>
                </div>
                <div class="grid-col-md-3 ">
                    <span class="badge badge-secondary">Cancelled</span>
                    <small class="d-block  text-muted">No longer active</small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-switch to tab based on URL hash
    document.addEventListener('DOMContentLoaded', function() {
        const hash = window.location.hash;
        if (hash) {
            const tabId = hash.substring(1) + '-tab';
            const tab = document.getElementById(tabId);
            if (tab) {
                const bsTab = new bootstrap.Tab(tab);
                bsTab.show();
            }
        }
    });

    // Update URL hash when tab changes
    const tabElements = document.querySelectorAll('#bookingTabs button[data-bs-toggle="tab"]');
    tabElements.forEach(tab => {
        tab.addEventListener('shown.bs.tab', function(event) {
            const target = event.target.getAttribute('data-bs-target');
            window.location.hash = target;
        });
    });
</script>
{% endblock %}
