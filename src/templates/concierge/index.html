{% extends "base.html" %}
{% block title %}AI Resource Concierge - Campus Resource Hub{% endblock %}{% block extra_css %}{% endblock %}{% block content %}<div class="concierge-hero">
  <div class="container">
    <h1>ðŸ¤– AI Resource Concierge</h1>
    <p class="subtitle">Just tell me what you need - I'll find it for you!</p>
  </div>
</div>

<div class="container">
  <!-- Search Interface -->
  <div class="search-container">
    <div class="search-box">
      <form id="concierge-form">
        <div class="space-b-3">
          <label class="form-label" for="query-input">What are you looking for?</label>
          <input autocomplete="off" class="query-input form-control" id="query-input" maxlength="500" name="query" placeholder="Try: 'Find a study room for 4 people tomorrow'" required="" type="text"/>
          <small class="text-dim">Ask in plain English - I understand natural language!</small>
        </div>
        
        <button class="search-btn btn btn--primary" id="search-btn" type="submit">
          <i class="bi bi-search icon"></i> Search
        </button>
      </form>
      
      <!-- Example Queries -->
      <div class="example-queries">
        <small class="text-dim">Try these examples:</small>
        </div></div></div></div>{% for example in examples %}{{ example }}">{{ example }}{% endfor %}<div class="loading-spinner" id="loading">
    <div class="spinner"></div>
    <p class="space-t-2">Thinking...</p>
  </div>
  
   Results Container 
  <div class="results-container" id="results-container">
    <!-- AI Response Message -->
    <div class="ai-message" id="ai-message"></div>
    
    <!-- Resource Grid -->
    <div class="resource-grid" id="resource-grid"></div>
    
    <!-- No Results -->
    <div class="no-results" id="no-results" style="display: none;">
      <i class="bi bi-inbox icon"></i>
      <h4>No results found</h4>
      <p>Try adjusting your search or browse all resources.</p>
      </div></div>{{ url_for('resources.index') }}" class="btn btn-outline">
        Browse All Resources
      
    
  
  
   Features Section (shown when no search yet) 
  <div class="features" id="features-section">
    <div class="feature-card">
      <div class="feature-icon">ðŸ’¬</div>
      <h3>Natural Language</h3>
      <p>Just ask in plain English - no complex filters needed</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">ðŸŽ¯</div>
      <h3>Smart Matching</h3>
      <p>I understand capacity, dates, times, and locations</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">âš¡</div>
      <h3>Instant Results</h3>
      <p>Get relevant resources in seconds</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">âœ…</div>
      <h3>Database Grounded</h3>
      <p>All results come from real, available resources</p>
    </div>
  </div>
{% endblock %}{% block extra_js %}{{ url_for("concierge.query") }}', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token() }}'
        },
        body: JSON.stringify({ query: query })
      });
      
      const data = await response.json();
      
      // Hide loading
      loading.classList.remove('show');
      searchBtn.disabled = false;
      
      // Show results
      displayResults(data);
      
    } catch (error) {
      console.error('Error:', error);
      loading.classList.remove('show');
      searchBtn.disabled = false;
      alert('An error occurred. Please try again.');
    }
  });
  
  function displayResults(data) {
    resultsContainer.classList.add('show');
    
    // Display AI message
    aiMessage.innerHTML = formatMessage(data.message);
    
    // Display resources
    if (data.results && data.results.length > 0) {
      resourceGrid.innerHTML = '';
      noResults.style.display = 'none';
      
      data.results.forEach(resource => {
        const card = createResourceCard(resource);
        resourceGrid.appendChild(card);
      });
    } else {
      resourceGrid.innerHTML = '';
      noResults.style.display = 'block';
    }
    
    // Scroll to results
    resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
  
  function formatMessage(message) {
    // Convert markdown-style bold to HTML
    return message
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\n\n/g, '<br/><br/>')
      .replace(/â€¢/g, '<i class="bi bi-check-circle icon"></i>');
  }
  
  function createResourceCard(resource) {
    const card = document.createElement('div');
    card.className = 'resource-result-card';
    
    card.innerHTML = `
      <h4>${resource.title}</h4>
      <p class="text-dim small">${resource.description || 'No description available'}</p>
      <div class="resource-meta">
        ${resource.capacity ? `<span><i class="bi bi-people icon"></i> ${resource.capacity}</span>` : ''}
        ${resource.location ? `<span><i class="bi bi-geo-alt icon"></i> ${resource.location}</span>` : ''}
        ${resource.category ? `<span class="badge badge-primary">${resource.category}</span>` : ''}
      </div>
      <a class="btn btn-primary" href="${resource.url}">
        View Details <i class="bi bi-arrow-right icon"></i>
      </a>
    `;
    
    return card;
  }
});

{% endblock %}