{% from"reviews/_star_rating.html" import render_star_rating, render_rating_summary %}{% macro render_review_list(reviews, resource, current_user, show_moderation=False) %}{#
  Review List Component
  
  Parameters:
  - reviews: List of review objects with reviewer info
  - resource: Resource being reviewed
  - current_user: Current logged-in user
  - show_moderation: Show admin moderation controls
#}<div class="reviews-section" id="reviews">
  <!-- Reviews Header -->
  <div class="flex">
    <h4>
      <i class="bi bi-chat-left-quote"></i>
      Reviews </h4></div></div>{% if reviews %}({{ reviews|length }}){% endif %}{% if resource.average_rating %}{{ render_rating_summary(resource.average_rating, reviews|length, size='md') }}{% endif %}{% if reviews %}<div class="reviews-list">
      </div>{% for review in reviews %}{% set is_own_review = current_user.is_authenticated and current_user.user_id == review.reviewer_id %}{% set is_hidden = review.is_hidden %}{% if is_hidden %}review-hidden{% endif %}" 
           id="review-{{ review.review_id }}">
          <div class="card-body">
            <!-- Review Header -->
            <div class="flex items-start">
              <div class="flex">
                <!-- Reviewer Avatar -->
                <div class="reviewer-avatar">
                  </div></div></div></div>{% if review.reviewer.profile_image %}{{ url_for('static', filename='uploads/' + review.reviewer.profile_image) }}" 
                       alt="{{ review.reviewer.name }}"
                       class="rounded-circle"
                       style="width: 48px; height: 48px; object-fit: cover;">
                  {% else %}<div class="bg-primary text-inverse" style="width: 48px; height: 48px; font-size: 1.25rem; font-weight: bold;">
                      </div>{{ review.reviewer.name[0]|upper }}{% endif %}<div>
                  <h6 class="space-b-0"></h6></div>{{ review.reviewer.name }}<div class="text-dim small">
                    </div>{{ render_star_rating(review.rating, size='sm') }}<span class="ms-2">
                      <i class="bi bi-clock"></i>
                      </span>{{ review.timestamp.strftime('%B %d, %Y') }}<div class="dropdown">
                <button aria-expanded="false" class="btn btn-link" data-bs-toggle="dropdown" type="button">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  </ul></div>{% if is_own_review %}<li>
                      </li>{{ url_for('resources.detail', resource_id=resource.resource_id) }}#review-form">
                        <i class="bi bi-pencil"></i>Edit Review
                      
                    
                    <li>
                      </li>{{ url_for('reviews.delete', review_id=review.review_id) }}" 
                         onsubmit="return confirm('Are you sure you want to delete this review?');" 
                         class="d-inline">
                        {{ csrf_token() }}">
                        <button class="dropdown-item" type="submit">
                          <i class="bi bi-trash"></i>Delete Review
                        </button>
                      
                    
                  {% endif %}{% if show_moderation and current_user.role == 'admin' %}<li><hr class="dropdown-divider"/></li>
                    <li class="dropdown-header">Admin Actions</li>
                    {% if is_hidden %}<li>
                        </li>{{ url_for('reviews.unhide', review_id=review.review_id) }}" 
                           class="d-inline">
                          {{ csrf_token() }}">
                          <button class="dropdown-item" type="submit">
                            <i class="bi bi-eye"></i>Unhide Review
                          </button>
                        
                      
                    {% else %}<li>
                        </li>{{ url_for('reviews.hide', review_id=review.review_id) }}" 
                           onsubmit="return confirm('Hide this review from public view?');" 
                           class="d-inline">
                          {{ csrf_token() }}">
                          <button class="dropdown-item" type="submit">
                            <i class="bi bi-eye-slash"></i>Hide Review
                          </button>
                        
                      
                    {% endif %}{% endif %}{% if not is_own_review and not show_moderation %}<li>
                      <a class="dropdown-item" href="#">
                        <i class="bi bi-flag"></i>Report Review
                      </a>
                    </li>
                  {% endif %}<div class="review-content">
              </div>{% if is_hidden %}<div class="alert alert-warning">
                  <i class="bi bi-eye-slash"></i>
                  <strong>This review has been hidden by an administrator.</strong>
                  </div>{% if current_user.role == 'admin' %}<p class="space-b-0"></p>{{ review.comment }}{% endif %}{% else %}<p class="space-b-0"></p>{{ review.comment }}{% endif %}{% if review.updated_at and review.updated_at != review.timestamp %}<div class="review-footer pad-t-2 border-top">
              <small class="text-dim">
                <i class="bi bi-pencil-square"></i>
                Edited on </small></div>{{ review.updated_at.strftime('%B %d, %Y') }}{% endif %}{% endfor %}{% if reviews|length > 10 %}<div class="text-center">
      <button class="btn btn-secondary">
        <i class="bi bi-arrow-down-circle"></i>Load More Reviews
      </button>
    </div>
    {% endif %}{% else %}<div class="text-center">
      <i class="bi bi-chat-left-quote" style="font-size: 4rem;"></i>
      <h5 class="space-t-3">No Reviews Yet</h5>
      <p class="text-dim">Be the first to review this resource!</p>
    </div>
  {% endif %}{% endmacro %}{% macro render_rating_distribution(reviews) %}{#
  Rating Distribution Component
  Shows breakdown of ratings (5-star: X, 4-star: Y, etc.)
  
  Parameters:
  - reviews: List of all reviews
#}{% set rating_counts = {5: 0, 4: 0, 3: 0, 2: 0, 1: 0} %}{% for review in reviews %}{% set _ = rating_counts.__setitem__(review.rating, rating_counts[review.rating] + 1) %}{% endfor %}{% set total_reviews = reviews|length %}<div class="rating-distribution card">
  <div class="card-header">
    <h5 class="space-b-0">
      <i class="bi bi-bar-chart"></i>Rating Distribution
    </h5>
  </div>
  <div class="card-body">
    </div></div>{% for rating in [5, 4, 3, 2, 1] %}{% set count = rating_counts[rating] %}{% set percentage = (count / total_reviews * 100)|int if total_reviews > 0 else 0 %}<div class="flex">
        <span class="me-2" style="min-width: 60px;">
          </span></div>{{ rating }}<i class="bi bi-star-fill"></i>
        
        <div class="progress" style="height: 8px;">
          </div>{{ percentage }}%;" 
             aria-valuenow="{{ percentage }}" 
             aria-valuemin="0" 
             aria-valuemax="100">
          
        
        <span class="text-dim" style="min-width: 50px;"></span>{{ count }}({{ percentage }}%)
      
    {% endfor %}{% endmacro %}