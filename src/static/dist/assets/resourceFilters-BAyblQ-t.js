class l{constructor(){this.drawer=document.querySelector('[data-drawer="filters"]'),this.backdrop=document.querySelector("[data-drawer-backdrop]"),this.toggle=document.querySelector("[data-filter-toggle]"),this.closeBtn=document.querySelector("[data-drawer-close]"),this.clearBtn=document.querySelector("[data-filter-clear]"),this.applyBtn=document.querySelector("[data-filter-apply]"),this.filterSections=document.querySelectorAll(".filter-section"),this.filterInputs=document.querySelectorAll("[data-filter-input]"),this.viewToggle=document.querySelectorAll("[data-view]"),this.searchClear=document.querySelector(".input-clear"),this.activeFilters=new Map,this.isOpen=!1,this.init()}init(){this.loadFiltersFromURL(),this.setupDrawerControls(),this.setupFilterSections(),this.setupFilterInputs(),this.setupViewToggle(),this.setupSearchClear(),this.setupKeyboardNavigation(),this.updateActiveFiltersUI(),this.updateFilterCount(),window.innerWidth>=1024&&this.activeFilters.size>0&&this.drawer.classList.add("is-open")}setupDrawerControls(){this.toggle&&this.toggle.addEventListener("click",()=>this.toggleDrawer()),this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.closeDrawer()),this.backdrop&&this.backdrop.addEventListener("click",()=>this.closeDrawer()),this.clearBtn&&this.clearBtn.addEventListener("click",()=>this.clearAllFilters()),this.applyBtn&&this.applyBtn.addEventListener("click",()=>{this.applyFilters(),this.closeDrawer()})}toggleDrawer(){this.isOpen?this.closeDrawer():this.openDrawer()}openDrawer(){this.isOpen=!0,this.drawer.classList.add("is-open"),this.backdrop.classList.add("is-open"),document.body.style.overflow="hidden";const e=this.drawer.querySelector("input, button");e&&setTimeout(()=>e.focus(),100),this.trapFocus()}closeDrawer(){this.isOpen=!1,this.drawer.classList.remove("is-open"),this.backdrop.classList.remove("is-open"),document.body.style.overflow="",this.toggle&&this.toggle.focus()}setupFilterSections(){this.filterSections.forEach(e=>{const t=e.querySelector(".filter-section__header"),s=e.querySelector(".filter-section__body");t&&s&&(t.addEventListener("click",()=>{e.classList.toggle("is-collapsed");const i=e.classList.contains("is-collapsed");t.setAttribute("aria-expanded",!i)}),t.setAttribute("role","button"),t.setAttribute("aria-expanded","true"),t.setAttribute("tabindex","0"),t.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.click())}))})}setupFilterInputs(){this.filterInputs.forEach(a=>{a.addEventListener("change",c=>{this.handleFilterChange(c.target),window.innerWidth>=1024&&this.applyFilters()})});const e=document.querySelector("[data-capacity-min]"),t=document.querySelector("[data-capacity-max]");e&&e.addEventListener("change",()=>{window.innerWidth>=1024&&this.applyFilters()}),t&&t.addEventListener("change",()=>{window.innerWidth>=1024&&this.applyFilters()});const s=document.querySelector("[data-availability-from]"),i=document.querySelector("[data-availability-to]");s&&s.addEventListener("change",()=>{window.innerWidth>=1024&&this.applyFilters()}),i&&i.addEventListener("change",()=>{window.innerWidth>=1024&&this.applyFilters()});const r=document.querySelector("[data-location-search]");r&&r.addEventListener("input",a=>{this.filterLocationList(a.target.value)})}handleFilterChange(e){const t=e.name,s=e.value;if(e.type==="checkbox"){if(e.checked)this.activeFilters.has(t)||this.activeFilters.set(t,[]),this.activeFilters.get(t).push(s);else if(this.activeFilters.has(t)){const i=this.activeFilters.get(t),r=i.indexOf(s);r>-1&&i.splice(r,1),i.length===0&&this.activeFilters.delete(t)}}this.updateActiveFiltersUI(),this.updateFilterCount()}applyFilters(){const e=new URL(window.location.href),t=new URLSearchParams,s=document.querySelector('[name="q"]');s&&s.value&&t.set("q",s.value),this.filterInputs.forEach(n=>{n.type==="checkbox"&&n.checked&&t.append(n.name,n.value)});const i=document.querySelector("[data-capacity-min]"),r=document.querySelector("[data-capacity-max]");i&&i.value&&t.set("capacity_min",i.value),r&&r.value&&t.set("capacity_max",r.value);const a=document.querySelector("[data-availability-from]"),c=document.querySelector("[data-availability-to]");a&&a.value&&t.set("date_from",a.value),c&&c.value&&t.set("date_to",c.value);const o=e.searchParams.get("sort");o&&t.set("sort",o),e.search=t.toString(),window.location.href=e.toString()}clearAllFilters(){this.filterInputs.forEach(a=>{a.type==="checkbox"&&a.name!=="status"&&(a.checked=!1)});const e=document.querySelector("[data-capacity-min]"),t=document.querySelector("[data-capacity-max]");e&&(e.value=""),t&&(t.value="");const s=document.querySelector("[data-availability-from]"),i=document.querySelector("[data-availability-to]");s&&(s.value=""),i&&(i.value=""),this.activeFilters.clear(),this.updateActiveFiltersUI(),this.updateFilterCount();const r=new URL(window.location.href);r.search="",window.location.href=r.toString()}loadFiltersFromURL(){const e=new URLSearchParams(window.location.search);e.forEach((a,c)=>{const o=document.querySelector(`[name="${c}"][value="${a}"]`);o&&o.type==="checkbox"&&(o.checked=!0,this.activeFilters.has(c)||this.activeFilters.set(c,[]),this.activeFilters.get(c).push(a))});const t=e.get("capacity_min"),s=e.get("capacity_max");if(t){const a=document.querySelector("[data-capacity-min]");a&&(a.value=t)}if(s){const a=document.querySelector("[data-capacity-max]");a&&(a.value=s)}const i=e.get("date_from"),r=e.get("date_to");if(i){const a=document.querySelector("[data-availability-from]");a&&(a.value=i)}if(r){const a=document.querySelector("[data-availability-to]");a&&(a.value=r)}}updateActiveFiltersUI(){const e=document.querySelector("[data-active-filters]"),t=document.querySelector(".filter-active__list");if(!e||!t)return;t.innerHTML="";let s=0;this.activeFilters.forEach((i,r)=>{i.forEach(a=>{s++;const c=document.createElement("div");c.className="filter-active__chip",c.innerHTML=`
          ${this.getFilterLabel(r,a)}
          <button type="button" data-remove-filter="${r}:${a}">
            <svg width="10" height="10" viewBox="0 0 10 10" fill="none">
              <path d="M1 1L9 9M1 9L9 1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        `,c.querySelector("button").addEventListener("click",()=>{this.removeFilter(r,a)}),t.appendChild(c)})}),s>0?(e.style.display="flex",this.clearBtn.disabled=!1):(e.style.display="none",this.clearBtn.disabled=!0)}getFilterLabel(e,t){const s={category:{study_room:"Study Room",equipment:"Equipment",lab:"Lab",space:"Event Space",tutoring:"Tutoring"},status:{published:"Published",draft:"Draft",archived:"Archived"}};return s[e]&&s[e][t]?s[e][t]:t.replace("_"," ").replace(/\b\w/g,i=>i.toUpperCase())}removeFilter(e,t){const s=document.querySelector(`[name="${e}"][value="${t}"]`);if(s&&(s.checked=!1),this.activeFilters.has(e)){const i=this.activeFilters.get(e),r=i.indexOf(t);r>-1&&i.splice(r,1),i.length===0&&this.activeFilters.delete(e)}this.updateActiveFiltersUI(),this.updateFilterCount(),this.applyFilters()}updateFilterCount(){const e=document.querySelector("[data-filter-count]");if(!e)return;let t=0;this.activeFilters.forEach(s=>{t+=s.length}),t>0?(e.textContent=t,e.style.display="flex"):e.style.display="none"}setupViewToggle(){this.viewToggle.forEach(t=>{t.addEventListener("click",()=>{const s=t.dataset.view;this.viewToggle.forEach(r=>r.classList.remove("is-active")),t.classList.add("is-active");const i=document.querySelector(".resources-grid");i&&(i.dataset.viewMode=s),localStorage.setItem("resourceViewMode",s)})});const e=localStorage.getItem("resourceViewMode");if(e){const t=document.querySelector(`[data-view="${e}"]`);t&&t.click()}}setupSearchClear(){this.searchClear&&this.searchClear.addEventListener("click",()=>{const e=document.querySelector('[name="q"]');e&&(e.value="",e.form.submit())})}filterLocationList(e){const t=document.querySelector("[data-location-list]");if(!t)return;const s=t.querySelectorAll(".filter-option"),i=e.toLowerCase();s.forEach(r=>{const a=r.querySelector(".filter-option__label");if(a){const c=a.textContent.toLowerCase();r.style.display=c.includes(i)?"flex":"none"}})}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen&&this.closeDrawer()})}trapFocus(){if(!this.drawer)return;const e=this.drawer.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),t=e[0],s=e[e.length-1],i=a=>{a.key==="Tab"&&(a.shiftKey?document.activeElement===t&&(s.focus(),a.preventDefault()):document.activeElement===s&&(t.focus(),a.preventDefault()))};this.drawer.addEventListener("keydown",i);const r=this.closeDrawer.bind(this);this.closeDrawer=()=>{this.drawer.removeEventListener("keydown",i),r()}}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".resources-browse-page")&&new l});
